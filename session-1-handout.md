# Student Handout

## Agenda - Session 1
1. Intro & Setting Up Your Environment
1. Basic Linux & Shell
1. Git Data Model - The Three Objects
1. Managing Local Changes - The Three Trees

## Intro & Setting up your environment



## Basic Linux & Shell
Review the [Basic Linux and Shell](basic-linux-commands) prework.

### Clone the learning-git repo
```
$ cd
$ mkdir -p src/codeplatoon
$ cd !$
$ git clone https://github.com/walquis/learning-git
$ cd learning-git
```

### Unpack the git objects that Github.com has packed
```
$ ls -l .git/objects  # Not much there
$ ls -l .git/objects/pack
$ ./unpack-objects.sh
$ ls -l .git/objects  # That's more like it!
$ ls -l .git/objects/pack
```

### Activate git aliases, append to profile

This will let you use cool shortcuts to see what's going on with your repo state.

```
$ cat git-aliases.sh
$ ls -l *.sh
$ ./git-aliases.sh
$ ./append-aliases-to-profile.sh
```

## Exploring the git repo - SHAs and objects

#### The git database
The git DB is "a content-addressable filesystem".&nbsp;  That is, objects are looked up ("addressed") based on their content.  How is this done?
```
$ git rev-parse HEAD
281fe7833c7693e7e1c45f62fae663620609e596
$ ls .git/objects/28
1fe7833c7693e7e1c45f62fae663620609e596
```
Where did the '1fe783...' string come from?  It's the address of the latest commit, generated by running that content through a SHA-1 hashing algorithm.

#### Storing objects in the git database
```
$ echo hi-there > hi.txt
$ cat hi.txt
hi-there
$ git hash-object hi.txt
41c363195bb36c6cc7bf185ef4ee2f4f1160bb14
$ ls .git/objects/41  # It's not there...
2a0098c03b586f4f67779b0ec1d9e61744d766
da9747be679144276d174aad5477ee87b2de39
$ git hash-object -w hi.txt
$ ls .git/objects/41  # Now it is!  '-w' = 'write to db'
2a0098c03b586f4f67779b0ec1d9e61744d766
c363195bb36c6cc7bf185ef4ee2f4f1160bb14
da9747be679144276d174aad5477ee87b2de39
$ git cat-file -p 41c3  # Don't need to say the whole sha
hi-there
```

Test your understanding: Describe the relationship between a SHA and a git repo object.

## The Three Git Objects - Commit, Tree, Blob

What kind of SHA is HEAD?
```
$ git cat-file -t HEAD
commit
```
What kind of SHA is 1563?
```
$ git cat-file -t 1563
tree
```
What kind of SHA is the one we stored with ```git hash-object```?
```
$ git cat-file -t 41c3
blob
```
So there they are.  __The Three Objects__.

How do they work in practice?

What if we were to add ```hi.txt``` to the repo?
```
$ git add hi.txt
$ git commit -m "Adding a file to the repo"
```
Examine the new commit using ```git cat-file -p```...

Consider this [object diagram](https://git-scm.com/book/en/v2/images/data-model-3.png){:target="_blank"}.  What would a diagram of your repo's last 2 commits look like?

## The Three Trees - HEAD, Index, Workspace

Git manages three trees in normal operation:

| Tree | Role |
| ---- | ---- |
| HEAD | The latest commit |
| Index | The commit-in-progress |
| Workspace | Your local filesystem |

On the 'green path' (that is, no mistakes or side journeys), changes start in the __workspace__ and flow to the __index__ via ```git add```, and finally into the repo via ```git commit``` (i.e., __HEAD__ moves to the next commit):

| __Affected tree:__ | Workspace | Index | HEAD
| --- | ---- | ---- |
| __Operation:__ | \<edit file\> | ```git add``` | ```git commit```

See also [this object diagram](https://git-scm.com/book/en/v2/images/reset-workflow.png){:target="_blank"}.

Sometimes it's necessary to bring changes the other way--for instance, when you need to add a forgotten file, change a commit message, or revert a commit.

```git reset```: The command that can assist with all this and more.  Why is it called "reset"?  Possibly because it resets trees to a state that already exists in the repo.  Unlike ```git add``` and ```git commit```, which push new states __into__ the repo, ```git reset``` pulls existing state the other way, __out__ of the repo, and into one or more of HEAD, the index, and even the workspace.

| Tree | Role | ```git reset``` "hardness"<br>needed to move the tree
| ---- | ---- | ----
| HEAD | The latest commit | \--soft
| Index | The commit-in-progress | \--mixed (also moves HEAD.) The default.
| Workspace | Your local filesystem | \--hard (also moves HEAD and Index.)

```git reset``` needs to know two things:
1. The "hardness"--that is, how many trees are to be reset, and
2. Which commit SHA to align the tree(s) with.

If you just type "git reset", the default hardness is "\--mixed", and the default commit SHA is HEAD.

## Putting It Together - Moving Objects Among Trees

Let's follow a file through its lifecycle, starting with workspace changes, which will flow through the index, and into a commit.  Then, we'll revert it, tree by tree, all the way back using ```git reset```.

### 1. Move a change forward through the trees

Make a change (which tree are you working in now?) ...
```
$ cd aDirectory
$ vim aFile.txt (or your preferred editor)
[Make it say "This is a fantastic file", and save]
$ git status
```

Add to the index.
```
$ git add aFile.txt
$ git status
$ gs  # This should do the same thing
```

Which tree (or trees) have the change now?

Commit it...
```
$ git rev-parse HEAD
$ git commit -m "make it fantastic"
$ git status
```

Now which tree (or trees) have the change?

### 2. Move the same change backward through the trees

Recall that besides specifying "hardness", we need to tell ```git reset``` the SHA to align with--that is, which SHA to reset to.

(What is the previous value of HEAD?)
```
$ git rev-parse HEAD
$ git reset
$ git rev-parse HEAD   # What happened?  Why?
$ git status
$ git reset --soft <previous-value-of-head>
$ git rev-parse HEAD
$ git status
```

What happened?  What is ```git status``` telling you, and why?

Now the branch that HEAD points to has been "reset", back to where it was before we committed.  Which tree has changed?

Let's change the next tree...
```
$ git reset   # Same command, but now something  happened.  Why?
$ git status
```

What changed this time?

Let's change the third tree...
```
$ git reset --hard
$ git status
```

Test your understanding: What happened to each tree at each step?


