<style>
  td { text-align: center; }
  tr.bb { border-bottom: 2px solid black !important; }
  .bb table { border-collapse:collapse; }
</style>

# Student Handout - Session 1

## Agenda
1. Intro & Setting Up Your Environment
1. Basic Linux & Shell
1. Git Data Model - The Three Objects
1. Managing Local Changes - The Three Trees
1. Git vs Github - Know the difference

## Intro & Setting up your environment

### Clone the learning-git repo
```
$ cd
$ mkdir -p src/codeplatoon
$ cd !$
$ git clone https://github.com/walquis/learning-git
$ cd learning-git
```

### Unpack the git objects that Github.com has packed
```
$ ls -l .git/objects  # Not much there
$ ls -l .git/objects/pack
$ ./unpack-objects.sh
$ ls -l .git/objects  # That's more like it!
$ ls -l .git/objects/pack
```

### Activate git aliases, append to profile

This will let you use cool shortcuts to see what's going on with your repo state.

```
$ cat git-aliases.sh
$ ls -l *.sh
$ ./git-aliases.sh   # Activate aliases in current shell
$ ./append-aliases-to-profile.sh  # So they'll be part of future shells.
$ adog  # This should work now.
```

## Basic Linux & Shell
Review the [Basic Linux and Shell](basic-linux-commands) prework.

## Exploring the git repo - SHAs and objects

#### The git database
The git DB is "a content-addressable filesystem".&nbsp;  That is, objects are looked up ("addressed") based on their content.  How is this done?
```
$ git rev-parse HEAD
281fe7833c7693e7e1c45f62fae663620609e596
$ ls .git/objects/28
1fe7833c7693e7e1c45f62fae663620609e596
```
Where did the '281fe783...' string come from?  It's the address of the latest commit, generated by running that content through a SHA-1 hashing algorithm.

#### Storing objects in the git database
```
$ echo hi-there > hi.txt
$ cat hi.txt
hi-there
$ git hash-object hi.txt
41c363195bb36c6cc7bf185ef4ee2f4f1160bb14
$ ls .git/objects/41  # It's not there...
2a0098c03b586f4f67779b0ec1d9e61744d766
da9747be679144276d174aad5477ee87b2de39
$ git hash-object -w hi.txt
$ ls .git/objects/41  # Now it is!  '-w' = 'write to db'
2a0098c03b586f4f67779b0ec1d9e61744d766
c363195bb36c6cc7bf185ef4ee2f4f1160bb14
da9747be679144276d174aad5477ee87b2de39
$ git cat-file -p 41c3  # Don't need to say the whole sha
hi-there
$ git cat-file -t 41c3 
blob
```

Test your understanding: Describe the relationship between a SHA and a git repo object.

#### Exercise: Commit hi.txt through "normal git commands"

```git hash-object``` is never directly used for version control. Go ahead and commit ```hi.txt``` into the repo, using the customary ```git add``` and ```git commit``` (or their equivalent aliases)

- What SHA corresponds to the commit?
- Can you find that SHA under .git/objects?
- Extra credit (we haven't covered this yet): Using ```git cat-file -p```, can you trace from the commit SHA, all the way to the blob SHA that contains the actual contents of ```hi.txt```?  HINT: there is a 'tree' SHA between the 'commit' and the 'blob', which is revealed by judicious use of ```git cat-file -p```.

#### While we're here...What else can we see in .git?
```
$ cd .git
$ ls -l
$ file HEAD 
HEAD: ASCII text
$ cat HEAD
ref: refs/heads/master
$ file refs/heads/master
refs/heads/master: ASCII text
$ cat !$  # BANG-dolla!
fc223df6e6f71a506f9bda0fac71b16041fd7004  # Ymmv
$ ls -l refs
$ ls -l refs/remotes
$ ls -l refs/remotes/origin
$ file refs/remotes/origin/master
$ cat !$
fc223df6e6f71a506f9bda0fac71b16041fd7004
```

So how is HEAD stored in the git repo?  How about local and remote branches?

## The Three Git Objects - Commit, Tree, Blob

What kind of SHA is HEAD?
```
$ git cat-file -t HEAD
commit
$ git cat-file -p HEAD
```
What kind of SHA is 722d?
```
$ git cat-file -t 722d
tree
```
What kind of SHA is the one we stored with ```git hash-object```?

What kind of SHA is the one we stored with ```git hash-object```?
```
$ git cat-file -t 41c3
blob
```

Consider this [object diagram](https://git-scm.com/book/en/v2/images/data-model-3.png){:target="_blank"}.  What SHAs from your repo (whether commit, tree, or blob) would correspond to this diagram's latest commit?

So there they are:  __The Three Objects__.  __commit__, __tree__, and __blob__. Next up: How do they work in practice?

## The Three Trees - HEAD, Index, Workspace

Git manages three trees in normal operation:

| Tree | Role |
| ---- | ---- |
| HEAD | The latest commit |
| Index | The commit-in-progress |
| Workspace | Your local filesystem |

On the 'green path' (that is, no mistakes or side journeys), changes start in the __workspace__ and flow to the __index__ via ```git add```, and finally into the repo via ```git commit``` (i.e., __HEAD__ moves to the next commit):

| __Affected tree:__ | Workspace | Index | HEAD
| --- | ---- | ---- |
| __Operation:__ | \<edit file\> | ```git add``` | ```git commit```

See also [this object diagram](https://git-scm.com/book/en/v2/images/reset-workflow.png){:target="_blank"}.

Sometimes it's necessary to bring changes the other way--for instance, when you need to add a forgotten file, change a commit message, or revert a commit.

```git reset```: The command that can assist with all this and more.  Why is it called "reset"?  Possibly because it resets trees to a state that already exists in the repo.  Unlike ```git add``` and ```git commit```, which push new states __into__ the repo, ```git reset``` pulls existing state the other way, __out__ of the repo, and into one or more of HEAD, the index, and even the workspace.

| Tree | Role | ```git reset``` "hardness"<br>needed to move the tree
| ---- | ---- | ----
| HEAD | The latest commit | \--soft
| Index | The commit-in-progress | \--mixed (also moves HEAD.) The default.
| Workspace | Your local filesystem | \--hard (also moves HEAD and Index.)

```git reset``` needs to know two things:
1. The "hardness"--that is, how many trees are to be reset, and
2. Which commit SHA to align the tree(s) with.

If you just type "git reset", the default hardness is "\--mixed", and the default commit SHA is HEAD.

## Putting It Together - Moving Objects Among Trees

Let's follow a file through its lifecycle, starting with workspace changes, which will flow through the index, and into a commit.  Then, we'll revert it, tree by tree, all the way back using ```git reset```.

### 1. Move a change forward through the trees

Make a change (which tree are you working in now?) ...
```
$ cd aDirectory
$ vim aFile.txt (or your preferred editor)
[Make it say "This is a fantastic file", and save]
$ git status  # or 'gs' alias
$ git diff  # or 'gd' alias
```

Add to the index.
```
$ git add aFile.txt   # or 'ga' aFile.txt
$ git status
$ git diff
$ git diff --staged   # or 'gds'
```

Which tree (or trees) have the change now?

Commit it...
```
$ git rev-parse HEAD
$ git commit -m "make it fantastic"  # or gc -m "..."
$ git status
```

Now which tree (or trees) have the change?

### 2. Move the same change backward through the trees

Recall that besides specifying "hardness", we need to tell ```git reset``` the SHA to align with--that is, which SHA to reset to.

(What is the previous value of HEAD?)
```
$ git rev-parse HEAD
$ git reset
$ git rev-parse HEAD   # What happened?  Why?
$ git rev-parse HEAD^   # What does the caret (^) mean?*
$ git status
$ git reset --soft <previous-value-of-head>
$ git rev-parse HEAD
$ git status
$ git diff
$ git diff --staged
```

\* See [Git Revisions](https://git-scm.com/docs/revisions){:target="_blank"}.

What happened?  What is ```git status``` telling you, and why?

What happened to the commit that we were on before doing a ```git reset```?  How might we get back to it?

Now the branch that HEAD points to has been "reset", back to where it was before we committed.  Which tree has changed?

Let's change the next tree...
```
$ git reset   # Same command, but now something  happened.  Why?
$ git status
$ git diff
$ git diff --staged
```

What changed this time?

Let's change the third tree...
```
$ git reset --hard
$ git status
$ git diff
$ git diff --staged
```

Test your understanding:
- What happened to each tree at each step?
- How is ```git reset <paths>``` the opposite of ```git add <paths>```?
- When would each variation of ```git reset``` come in handy?

### Another picture of how ```"git reset --soft/mixed/hard <ToThisCommit>"``` &nbsp;works

<!-- Github Markdown doesn't do colspan -->
<table class="bb">
<tr><th>"hardness"</th><th colspan="3">Trees that are reset &lt;ToThisCommit&gt;</th></tr>
<tr class="bb"><th></th><th>Workspace</th><th>Index</th><th>HEAD</th></tr>
<tr><td>--soft</td><td>-</td><td>-</td><td>YES</td></tr>
<tr><td>--mixed</td><td>-</td><td>YES</td><td>YES</td></tr>
<tr><td>--hard</td><td>YES</td><td>YES</td><td>YES</td></tr>
</table>

## Git versus Github

The git client is a big bag of commands for implementing version control using a local content-addressable DB (aka a repository, or "repo"), as well as efficiently communicating with other, remote repos\--a Distributed Version Control System, or DVCS.  Git was written by Linus Torvalds in 2005 for version-controlling the Linux kernel.

In 2008, the social platform https://github.com came into existence, built around the git client.

When working with git and github, it's useful to keep in mind which operations belong to which system.  For instance...

| git | github |
| --- | --- |
| clone | fork |
| commit | |
| push | |
| pull | pull request |
| merge | |
| repo | repo |
| | org |
| | team, collaborator, org owner |
